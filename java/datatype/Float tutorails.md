

# æµ®ç‚¹æ•°çš„ä¸€äº›çŸ¥è¯†

**By HZ**

| ç‰ˆæœ¬ | å¤‡æ³¨                                                         |    æ—¥æœŸ    |
| :--: | ------------------------------------------------------------ | :--------: |
| 1.0  | åˆå§‹ç‰ˆæœ¬                                                     | 2020/11/8  |
| 1.1  | é‡æ„æ–‡æ¡£ç»“æ„å’Œå†…å®¹<br />1. å¢åŠ é—®é¢˜ç« èŠ‚<br />2. å¯¹æµ®ç‚¹æ•°ç›¸å…³æ¦‚å¿µè¿›è¡Œå®Œå–„<br />3. å¯¹æ–‡æ¡£é€»è¾‘ç»“æ„è¿›è¡Œè°ƒæ•´ | 2024/12/30 |

## 1. é—®é¢˜

1. å¯¹äºä»¥ä¸‹Javaä»£ç ï¼Œè¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

   ```java
       float sum = 0.0f;
       for (int i = 0; i < 1000000; i++) {
           sum += 0.1f;
       }
       System.out.printf("sum:%.3f\n", sum);
   ```

2. åŒæ ·éµå®ˆIEEE 754æµ®ç‚¹æ•°æ ‡å‡†ï¼ŒJavaå’ŒC++è¾“å‡ºç»“æœæ˜¯å¦ç›¸åŒï¼Ÿ

   ```c++
       //C++
       double var = 3.425;
       printf("var=%.16f\n", var);
       //Java
       double var = 3.425;
       System.out.printf("var=%.16f\n", var);
   ```

3. æ•°æ®åº“ï¼ˆOracleï¼‰ä¸­å­˜å‚¨çš„æ•°å€¼ä¸º**932.525**ï¼Œåœ¨C++çš„å®¢æˆ·ç«¯ï¼Œä¿ç•™ä¸¤ä½å°æ•°æ˜¾ç¤ºä¸º**932.52**ï¼Œåœ¨åŸºäºJavaåç«¯ï¼ŒJavascriptå‰ç«¯çš„Webåº”ç”¨ä¸­ï¼Œä¿ç•™ä¸¤ä½å°æ•°åæ˜¾ç¤º**932.53**ï¼Œè°æ˜¾ç¤ºçš„æ˜¯å¯¹çš„ï¼Ÿ

4. ä¸åŒçš„è¯­è¨€ï¼Œå¦‚æœæ¶‰åŠåˆ°äº’ç›¸è°ƒç”¨ï¼Œæµ®ç‚¹å‹å‚æ•°ä¼ é€’æ—¶ï¼Œåº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ

5. Javaè¯­è¨€ä¸­ï¼Œä¸ºä»€ä¹ˆBigDecimalå°±å¯ä»¥è¡¨è¾¾ä»»æ„çš„æœ‰æ•ˆæ•°å­—ï¼Œä»»æ„çš„èŒƒå›´ï¼Ÿ

6. ä¸ºä»€ä¹ˆè¦æœ‰éè§„çº¦åŒ–æ•°å­—ï¼Ÿ

## 2. IEEE 754ç®€ä»‹

### 2.1. ç§‘å­¦è®¡æ•°æ³•

åè¿›åˆ¶çš„ç§‘å­¦æŠ€æœ¯æ³•é€šå¸¸ç”¨ä¸€ä¸ªæ•°å­—ä¹˜ä»¥10çš„næ¬¡æ–¹æ¥è¡¨ç¤ºï¼Œå½¢å¦‚$$a*10^n$$

- $$57.34=5.734*10^2$$
- $$0.03424=3.424*10^{-2}$$

äºŒè¿›åˆ¶çš„è§„çº¦åŒ–è¡¨è¾¾æ–¹å¼å’Œç§‘å­¦è®¡æ•°æ³•ç±»ä¼¼ï¼Œå½¢å¦‚$(-1)^{sign}\times1.b_1b_2...b_n*2^e$

### 2.2. **æœ‰æ•ˆä½æ•° vs ç²¾åº¦**

ä¸¤ä¸ªç›¸å…³ä½†æ˜¯ä¸å®Œå…¨ç›¸åŒçš„æ¦‚å¿µï¼Œåœ¨IEEE 754ä¸­

1. **æœ‰æ•ˆä½æ•°ï¼ˆSignificant Digitsï¼‰**

   æœ‰æ•ˆä½æ•°æŒ‡çš„æ˜¯æ•°å€¼ä¸­ä»æœ€é«˜æœ‰æ•ˆä½ï¼ˆä¸ä¸ºé›¶çš„ç¬¬ä¸€ä½ï¼‰åˆ°æœ€åä¸€ä½çš„æ€»ä½æ•°ï¼Œç”¨äºè¡¡é‡ä¸€ä¸ªæ•°å€¼çš„**è¡¨ç¤ºèŒƒå›´å†…çš„ä¿¡æ¯é‡**

   * æ•°å€¼ `1.234` æœ‰ 4 ä½æœ‰æ•ˆæ•°å­—
   * æ•°å€¼ `1.234 Ã— 10Â³` æœ‰ 4 ä½æœ‰æ•ˆæ•°å­—
   * æ•°å€¼ `0.00123` æœ‰ 3 ä½æœ‰æ•ˆæ•°å­—ï¼ˆå‰å¯¼é›¶ä¸ç®—æœ‰æ•ˆä½æ•°ï¼‰

   

   ```c++
       float f1 = 1024.0009765625;
       float f2 = 1024.0009765624;
       float f3 = 1125899906842624;
       float f4 = 1125899906942624;
   	// å¥½åƒæœ‰æ•ˆæ•°å­—æœ‰17ä½
       printf("%.17f\n%.17f\n%.17f\n%.17f\n", f1, f2, f3, f4);
   
       float f5 = 1024.001;
       float f6 = 1024.002;
   	// å¥½åƒæœ‰æ•ˆæ•°å­—ä¸è¶³7ä½
       printf("%.17f\n%.17f\n", f5, f6);
   
   	result:
   	----------------
       1024.00097656250000000
       1024.00097656250000000
       1125899906842624.00000000000000000
       1125899906842624.00000000000000000
           
       1024.00097656250000000
       1024.00195312500000000
   ```

   

2. **ç²¾åº¦ï¼ˆPrecisionï¼‰**

   **ç²¾åº¦**åœ¨ IEEE 754 ä¸­æ˜¯ä¸€ä¸ªæ›´å¹¿æ³›çš„æ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯æµ®ç‚¹æ•°è¡¨ç¤ºå€¼çš„**åˆ†è¾¨èƒ½åŠ›**ï¼Œå³èƒ½å¤ŸåŒºåˆ†ä¸¤ä¸ªç›¸é‚»æ•°å€¼çš„èƒ½åŠ›ï¼ŒåŒæ—¶ä¹Ÿè¡¨è¾¾æ•°å­—çš„èŒƒå›´
   
   ![](./p1.png)
   
   
   
   â†‘ æ•°å­¦ä¸­çš„æ•´æ•°æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„ï¼Œæƒ³è±¡ç»¿è‰²æŒ‡é’ˆå¿…é¡»ä¸€æ¬¡èµ°ä¸€æ ¼
   
   â†‘ æ•°å­¦ä¸­çš„å°æ•°æ˜¯è¿ç»­çš„ï¼Œæƒ³è±¡ç»¿è‰²æŒ‡é’ˆå¯ä»¥æ— æè°ƒèŠ‚ï¼Œ æƒ³èµ°åˆ°å“ªå„¿èµ°åˆ°å“ªå„¿
   
   â†‘ è®¡ç®—æœºä¸­å­˜å‚¨çš„å°æ•°æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„ï¼Œç»¿è‰²æŒ‡é’ˆå¿…é¡»ä¸€æ¬¡èµ°ä¸€æ ¼ï¼Œå°±åƒæ•´æ•°é‚£æ ·
   
   
   
   è¿™å°±å¼•å‘äº†ç²¾åº¦çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬æ— æ³•åœ¨è®¡ç®—æœºä¸­å­˜å‚¨0.3ï¼Œå› ä¸ºç»¿è‰²æŒ‡é’ˆåªèƒ½ä¸€æ¬¡èµ°ä¸€æ ¼ï¼Œè¦ä¹ˆåœ¨0.234ï¼Œè¦ä¹ˆå°±åˆ°äº†0.468...ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¢åŠ è®¡ç®—æœºå­˜å‚¨å°æ•°çš„ç²¾åº¦ï¼Œæˆ–è€…è¯´ç¼©å°ç‚¹ä¸ç‚¹ä¹‹é—´çš„é—´éš”ã€‚
   
   ![](./p2.png)
   
   
   
   æµ®ç‚¹æ•°åœ¨è®¡ç®—æœºå†…éƒ¨å­˜å‚¨ï¼Œé—´éš”å¹¶ä¸æ˜¯ç­‰è·çš„ï¼Œç±»ä¼¼ä¸ä¸‹é¢çš„å›¾å½¢ï¼Œè¶Šå°çš„æ•°æ®ï¼Œé—´éš”ä¹Ÿè¶Šå°ï¼Œè¶Šå¤§çš„æ•°	å­—ï¼Œé—´éš”ä¹Ÿè¶Šå¤§ã€‚
   
   ![](./p4.png)
   
   ```c++
   	float f1 = 16777215;
   	// 16777216æ˜¯ä¸´ç•Œç‚¹ï¼Œå®ƒä¹‹å‰ï¼Œé—´éš”æ˜¯1ï¼Œå®ƒä¹‹åï¼Œé—´éš”æ˜¯2
   	float f2 = 16777216;
   	float f3 = 16777217;
   	float f4 = 16777218;
   	printf("%f\n%f\n%f\n%f\n", f1, f2, f3, f4);
   
   	result:
   	-------------
       16777215.000000
       16777216.000000
       16777216.000000
       16777218.000000
   ```

### 2.3. æµ®ç‚¹å‹å­˜å‚¨ç»“æ„

åœ¨è®¡ç®—æœºä¸­ï¼Œæµ®ç‚¹æ•°ä¹Ÿåˆ©ç”¨ç§‘å­¦è®¡æ•°æ³•æ¥è¡¨è¾¾ï¼Œä½†æ˜¯è®¡ç®—æœºä½¿ç”¨äºŒè¿›åˆ¶ï¼Œæ‰€ä»¥å°±é‡‡ç”¨äºŒè¿›åˆ¶çš„ç§‘å­¦è®¡æ•°æ³•æ¥è¡¨è¾¾ã€‚æµ®ç‚¹æ•°ï¼ˆåŒç²¾åº¦64ä½ï¼‰å­˜å‚¨ç»“æ„ï¼š

![IEEE754_Double_Point](./IEEE_754_Double_Floating_Point_Format.png)

æµ®ç‚¹æ•°æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ç¬¦å·ä½ï¼ˆsignï¼‰ã€æŒ‡æ•°ä½ï¼ˆexponentï¼‰ã€å°¾æ•°ï¼ˆmantissa/fractionï¼‰

- **Sign bit: 1 bit**

  ç¬¦å·ä½å†³å®šäº†æ•°å­—æ˜¯æ­£æ•°è¿˜æ˜¯è´Ÿæ•°ï¼Œ**äºŒè¿›åˆ¶0ä»£è¡¨æ­£æ•°ï¼Œ1ä»£è¡¨è´Ÿæ•°**

- **Exponent: 11 bit**

  æŒ‡æ•°æ˜¯ç”±11ä½ç»„æˆï¼Œä»£è¡¨$$[0,2047]$$ï¼ˆ$$2047=2^{11}-1$$ï¼‰ã€‚å‚è€ƒåè¿›åˆ¶å°æ•°çš„ç§‘å­¦è®¡æ•°æ³•ï¼ˆæ¯”å¦‚è¯´$$3.2Ã—10^{-2}$$ï¼‰ï¼ŒäºŒè¿›åˆ¶ä¸ºäº†è¡¨è¾¾å°æ•°ï¼ŒæŒ‡æ•°ä¹Ÿéœ€è¦æ”¯æŒè´Ÿæ•°ï¼Œé€šè¿‡äºŒè¿›åˆ¶åç§»é‡æ–¹æ³•ï¼Œå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è®²è§£åç§»é‡æ–¹æ³•ä¹‹å‰ï¼Œ
  
  æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚å¦‚æœæœ‰ä¸€ä¸ªç±»åˆ«çš„æµ®ç‚¹æ•°ç”¨4ä½æ¥è¡¨è¾¾æŒ‡æ•°ï¼ˆå‡æƒ³çš„ä¾‹å­ï¼Œåº”è¯¥æ²¡æœ‰è¿™ä¸ªç±»åˆ«ï¼‰ï¼Œé‚£ä¹ˆæŒ‡æ•°çš„èŒƒå›´ä¸º$$e\in[0,2^4-1]$$ï¼Œå·²çŸ¥åç§»é‡å…¬å¼ä¸º$$2^{n-1}-1$$ï¼Œå› æ­¤åç§»é‡ä¸º7ã€‚
  
  åç§»é‡æ–¹æ³•è¦è§£å†³çš„é—®é¢˜æ˜¯èƒ½å¤Ÿè¡¨è¾¾è´ŸæŒ‡æ•°ï¼ŒåŒæ—¶è®©æ­£è´ŸæŒ‡æ•°åˆ†å¸ƒèŒƒå›´å‡ç­‰ï¼Œå› æ­¤æˆ‘ä»¬è®©æ¯ä¸€ä¸ªåŸå§‹çš„æŒ‡æ•°éƒ½å‡å»åç§»é‡7ï¼Œè¿™æ ·åŸæœ¬$$[0,15]$$çš„è¡¨è¾¾èŒƒå›´å˜æˆäº†$$[-7,8]$$ã€‚
  
  
  
  > [!TIP]
  >
  > å…³äºåç§»é‡ï¼Œé’ˆå¯¹ä¸åŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œåç§»é‡å¦‚ä¸‹
  >
  > * **åŠç²¾åº¦æµ®ç‚¹æ•°ï¼š**åç§»é‡=$2^{5-1}-1=15$
  >
  > * **å•ç²¾åº¦æµ®ç‚¹æ•°ï¼š**åç§»é‡=$2^{8-1}-1=127$
  >
  > * **åŒç²¾åº¦æµ®ç‚¹æ•°ï¼š**åç§»é‡=$$2^{11-1}-1=1023$$
  >
  >   > [!tip]
  >   >
  >   > åŠç²¾åº¦æŒ‡æ•°ä½ä½¿ç”¨5ä½ï¼Œå•ç²¾åº¦æŒ‡æ•°ä½ä½¿ç”¨8ä½ï¼ŒåŒç²¾åº¦æŒ‡æ•°ä½ä½¿ç”¨11ä½
  
  
  
  å›åˆ°åŒç²¾åº¦æµ®ç‚¹æ•°çš„åç§»é‡ï¼Œæ ¹æ®å…¬å¼è®¡ç®—ç»“æœï¼Œ$e\in[2^{0-1023}, 2^{2047-1023}]=e\in[2^{-1023},2^{1024}]$ï¼Œä½†æ˜¯`-1023,1024`æ˜¯ä¸¤ä¸ªç‰¹æ®Šçš„å€¼ï¼Œ`-1023`ä»£è¡¨éè§„æ ¼åŒ–æ•°æ®ï¼ˆéè§„æ ¼åŒ–æ•°ç”¨äºè¡¨ç¤ºéå¸¸æ¥è¿‘äºé›¶çš„æ•°ï¼‰,`1024`ä»£è¡¨è´Ÿæ— ç©·æˆ–è€…æ­£æ— ç©·ï¼ˆæ­£è´Ÿé ç¬¦å·ä½å†³å®šï¼‰ã€‚å¦å¤–ï¼ŒæŒ‡æ•°ä½å’Œå°¾æ•°ä½å¦‚æœå…¨ä¸º0ï¼Œåˆ™ä»£è¡¨æ•°å­—0ï¼ˆç¬¦å·ä½ä¸åŒåŒºåˆ†æ­£0å’Œè´Ÿ0ï¼‰ã€‚ç»¼ä¸Šæ‰€è¿°ï¼ŒåŒç²¾åº¦çš„æŒ‡æ•°èŒƒå›´ä¸º$e\in[2^{-1022}, 2^{1023}]$ï¼Œè¿™ä¸ªæŒ‡æ•°èŒƒå›´å¯¹åº”åˆ°åè¿›åˆ¶ä¸º$e\in[10^{-308}, 10^{308}]$ã€‚
  
  
  
  > [!TIP]
  >
  > ä¸ºä»€ä¹ˆæ˜¯10çš„308æ¬¡æ–¹å‘¢ï¼Ÿ
  >
  > $10^x\approx2^{1023}=>x\approx 1023 \times log_{10}^2=>x\approx 308$
  
  
  
  **åç§»é‡æ–¹æ³•**
  
  é¦–å…ˆè¯´æ˜ä¸‹é¢è¡¨æ ¼å„ä¸ªåˆ—çš„å«ä¹‰ï¼š
  
  * **å­˜å‚¨æŒ‡æ•°ï¼š**æµ®ç‚¹æ•°åœ¨äºŒè¿›åˆ¶å­˜å‚¨ç»“æ„ä¸­ï¼Œå­˜å‚¨çš„äºŒè¿›åˆ¶æ‰€ä»£è¡¨çš„åè¿›åˆ¶å€¼
  
  * **å­˜å‚¨æŒ‡æ•°äºŒè¿›åˆ¶ï¼š**æµ®ç‚¹æ•°åœ¨äºŒè¿›åˆ¶å­˜å‚¨ç»“æ„ä¸­ï¼Œå­˜å‚¨çš„äºŒè¿›åˆ¶
  
  * **å®é™…æŒ‡æ•°ï¼š**é€šè¿‡åç§»é‡æ–¹æ³•è®¡ç®—åçš„åè¿›åˆ¶æ•°å€¼
  
  * **å®é™…æŒ‡æ•°äºŒè¿›åˆ¶ï¼ˆè¡¥ç å½¢å¼ï¼‰ï¼š**é€šè¿‡åç§»é‡æ–¹æ³•è®¡ç®—åçš„äºŒè¿›åˆ¶æ•°å€¼ï¼ˆè¡¥ç å½¢å¼ï¼ŒTwo's complementï¼‰
  
    | å­˜å‚¨æŒ‡æ•° | å­˜å‚¨æŒ‡æ•°äºŒè¿›åˆ¶ | å®é™…æŒ‡æ•° | å®é™…æŒ‡æ•°äºŒè¿›åˆ¶ï¼ˆTwo's complementï¼‰ |
    | :------: | :------------: | :------: | :--------------------------------: |
    |    15    |      1111      |    8     |                1000                |
    |    14    |      1110      |    7     |                0111                |
    |    13    |      1101      |    6     |                0110                |
    |    12    |      1100      |    5     |                0101                |
    |    11    |      1011      |    4     |                0100                |
    |    10    |      1010      |    3     |                0011                |
    |    9     |      1001      |    2     |                0010                |
    |    8     |      1000      |    1     |                0001                |
    |    7     |      0111      |    0     |                0000                |
    |    6     |      0110      |    âˆ’1    |                1111                |
    |    5     |      0101      |    âˆ’2    |                1110                |
    |    4     |      0100      |    âˆ’3    |                1101                |
    |    3     |      0011      |    âˆ’4    |                1100                |
    |    2     |      0010      |    âˆ’5    |                1011                |
    |    1     |      0001      |    âˆ’6    |                1010                |
    |    0     |      0000      |    âˆ’7    |                1001                |


- **Mantissa: 53 bit (52 explicitly stored)**

  äºŒè¿›åˆ¶çš„è§„çº¦åŒ–è¡¨è¾¾æ–¹å¼è¦æ±‚ç¬¬ä¸€ä½éé›¶ï¼ŒäºŒè¿›åˆ¶é0åŠ1ï¼Œå› æ­¤ï¼ŒäºŒè¿›åˆ¶çš„è§„çº¦åŒ–è¡¨è¾¾æ–¹å¼æ˜¯<font color='RED'>$1.b_1b_2...b_n*2^e$</font>ã€‚ä¸ºäº†æ‰©å¤§æœ‰æ•ˆä½æ•°ï¼Œç¬¬ä¸€ä½çš„1ä½œä¸ºå›ºå®šå€¼ï¼ˆè¿™ä¸€ä½æ˜¯éšè—å€¼ï¼Œä¸éœ€è¦å ç”¨å­˜å‚¨ä½ï¼‰ï¼Œå› æ­¤æœ‰æ•ˆä½æ•°ä»52å˜æˆ53ï¼Œä¹Ÿå°±æ˜¯$b_n$ä¸­çš„n=53
  
  
  
  > [!TIP]
  >
  > doubleçš„æœ‰æ•ˆä½æ•°ä¸º15åˆ°16ä½ï¼Œä¸ºä»€ä¹ˆæ˜¯15åˆ°16ä½æœ‰æ•ˆæ•°å­—ï¼Ÿ
  >
  > $10^x\approx 2^{53}=>x\approx 53\times log_{10}^2=>x\approx15.92$
  
  

ç»“åˆä»¥ä¸ŠçŸ¥è¯†ï¼ŒäºŒè¿›åˆ¶æµ®ç‚¹æ•°è¡¨è¾¾æ–¹å¼å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯äºŒè¿›åˆ¶æ–¹å¼å’Œåè¿›åˆ¶æ–¹å¼ã€‚å…¶ä¸­äºŒè¿›åˆ¶è¡¨è¾¾æ–¹	å¼æ›´åå‘äºå­˜å‚¨ç»“æ„ï¼›åè¿›åˆ¶è¡¨è¾¾åå‘äºäººç±»çš„ç†è§£å’Œåº”ç”¨ç¨‹åºè¾“å‡ºã€‚

- **äºŒè¿›åˆ¶ï¼ˆBinaryï¼‰**

  $(-1)^{sign}(1.b_{51}b_{50}b_{49}...b_0)_2\times2^{e-1023}$
- **åè¿›åˆ¶ï¼ˆDecimalï¼‰**

  $(-1)^{sign}\left(1+\sum_{i=1}^{52}b_{52-i}\times2^{-i}\right)\times2^{e-1023}$



æˆ‘ä»¬é€šè¿‡ä¸€äº›ä¾‹å­è¿›ä¸€æ­¥åŠ æ·±ç†è§£ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸ªåŠç²¾åº¦æµ®ç‚¹æ•°çš„è®¡ç®—è¿‡ç¨‹ï¼š

![](./half-precision-floating-point-number-explained.png)



> [!TIP]
>
> ç­‰æ¯”æ•°åˆ—çš„æ±‚å’Œå…¬å¼
>
> $S_n=a_1\times\frac{1âˆ’r^n}{1-r}$
>
> å…¶ä¸­
>
> * $a_1$ï¼šæ•°åˆ—çš„ç¬¬ä¸€é¡¹
> * rï¼šå…¬æ¯”
> * nï¼šé¡¹æ•°

* $0\ 01111111111\ 0000000000000000000000000000000000000000000000000000_2=2^{1023-1023}\times (1+0)=2^0\times 1 = 1$

* $0\ 01111111111\ 0000000000000000000000000000000000000000000000000001_2=2^{1023-1023}\times (1+2^{-52}) \approx 1.0000000000000002$

* $0\ 01111111111\ 0000000000000000000000000000000000000000000000000010_2=2^{1023-1023} \times (1 + 2^{-51}) \approx 1.0000000000000004$

* $1\ 10000000000\ 0000000000000000000000000000000000000000000000000000_2=-2^{1024-1023} \times (1 + 0) = -2$

* $0\ 10000000000\ 1000000000000000000000000000000000000000000000000000_2=2^{1024-1023} \times (1 + 1 \times 2^{-1})=2\times1.5=3$

> [!TIP]
>
> æˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡ç”¨ç§»ä½æ–¹æ³•å®ç°äºŒè¿›åˆ¶->åè¿›åˆ¶çš„è½¬åŒ–
>
> $2^{1024-1023} \times 1.1_2=2^1 \times 1.1_2 = 11_2 =3$
>
> äºŒè¿›åˆ¶ä¹˜ä»¥2ï¼Œå°±å¥½æ¯”åè¿›åˆ¶ä¹˜ä»¥10ï¼Œæ‰€ä»¥$1.1_2\times2^1=11_2=3$



* $0\ 10000000011\ 0111000000000000000000000000000000000000000000000000_2=2^{1027-1023} \times 1.0111_2 = 2^4 \times 1.0111 = 10111_2=2^4+2^2+2^1+2^0=23$

* $0\ 01111111000\ 1000000000000000000000000000000000000000000000000000_2=2^{1016-1023} \times 1.1_2 = 2^{-7} \times 1.1_2 = 0.00000011_2=1 \times 2^{-7} + 1 \times 2^{-8} = \frac{3}{2^8} = 0.01171875$

  

> [!IMPORTANT]
>
> ç‰¹æ®Šçš„æ•°å­—
>
> * **æœ€å°æ­£æ•´æ•°**
>
>   $0\ 00000000001\ 0000000000000000000000000000000000000000000000000000_2=2^{1-1023} \times 1 \approx 2.225 \times 10^{-308}$
>
> * **æœ€å¤§æ­£æ•´æ•°**
>
>   $0\ 11111111110\ 1111111111111111111111111111111111111111111111111111_2=2^{2046-1023} \times (1 + (1 - 2^{-52})) \approx 1.798 \times 10^{308}$
>
>   å…¶ä¸­ï¼Œå°¾æ•°éƒ¨åˆ†æœ‰ä¸€éƒ¨åˆ†æ˜¯$1-2^{-52}$ï¼Œå› ä¸ºæ˜¯ç­‰æ¯”æ•°é‡æ±‚å’Œï¼Œå¯ä»¥ç›´æ¥æŒ‰ç…§å…¬å¼è®¡ç®—è·å¾—
>
>   $2^{-1} + 2^{-2} + ... + 2^{-52} = 2^{-1} \times \left(\frac{1-(2^{-1})^{52}}{1-2^{-1}}\right) =1-2^{-52}$
>
> * **+$\infty$**
>
>   $0\ 11111111111\ 0000000000000000000000000000000000000000000000000000_2=7FF0 0000 0000 0000_{16}=+\infty$
>
> * **-$\infty$**
>
>   $1\ 11111111111\ 0000000000000000000000000000000000000000000000000000_2=FFF0 0000 0000 0000_{16}=-\infty$
>
> * **NaN**ï¼ˆå°¾æ•°ä½ä¸å…¨ä¸º0çš„å³å¯ï¼Œä¹Ÿå°±æ˜¯7FFF 0000 0000 0000ä¹Ÿæ˜¯NaNï¼‰
>
>   $0\ 11111111111\ 1111111111111111111111111111111111111111111111111111_2=7FFF FFFF FFFF FFFF_{16}=NaN$
>
> * **éè§„çº¦åŒ–æ•°å­—**
>
>   å¯¹äºåŒç²¾åº¦æµ®ç‚¹å‹æ¥è¯´ï¼ŒæŒ‡æ•°ä½å…¨éƒ¨ä¸º0ï¼Œå°¾æ•°ç¬¬ä¸€ä½å¿…é¡»ä¸º1ï¼Œè¡¨è¾¾å¼ä¸º$(-1)^{sign}\times2^{-1022}\times0.b_1b_2..b_52$ï¼Œåç§»é‡æ–¹æ³•çº¦å®šå®é™…æŒ‡æ•°e=E - 1023ï¼Œä½†æ˜¯754æ ‡å‡†çº¦å®šï¼Œå®é™…æŒ‡æ•°åŒæ ·ä¸º-1022ï¼Œä¿æŒå’Œè§„çº¦åŒ–æœ€å°æŒ‡æ•°ä¸€è‡´ã€‚

## 3. å›ç­”é—®é¢˜

1. å¯¹äºä»¥ä¸‹Javaä»£ç ï¼Œè¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

   ```java
       float sum = 0.0f;
       for (int i = 0; i < 1000000; i++) {
           sum += 0.1f;
       }
       System.out.printf("sum:%.3f\n", sum);
   
       result
       -----------------
       sum:100958.344
   ```

   å¯¹äºå•ç²¾åº¦æµ®ç‚¹æ•°0.1ï¼Œå…¶å®è®¡ç®—æœºå¹¶æ²¡æœ‰åŠæ³•å‡†ç¡®çš„è¡¨è¾¾ï¼Œå…¶äºŒè¿›åˆ¶è¡¨ç¤ºä¸º`0 01111011 10011001100110011001101`ï¼Œå…¶å¯¹åº”çš„åè¿›åˆ¶æ•°ä¸º`0.100000001490116119384765625`ï¼Œç»è¿‡100wæ¬¡ç´¯è®¡åŠ æ³•ï¼Œè¯¯å·®è¢«å‘ˆç°å‡ºæ¥ï¼Œè€Œä¸”è¯¯å·®å¾ˆå¤§ã€‚

   
   
   > [!TIP]
   >
   > åè¿›åˆ¶æµ®ç‚¹æ•°0.1å¦‚ä½•è½¬åŒ–ä¸ºäºŒè¿›åˆ¶è¿›è¡Œå­˜å‚¨ï¼Ÿ
   >
   > å¯¹äºåè¿›åˆ¶æ•°ï¼Œè½¬æ¢ä¸ºäºŒè¿›åˆ¶å°æ•°é‡‡ç”¨ â€œä¹˜å–æ•´â€ çš„æ–¹æ³•ã€‚
   >$$
   > 0.1\times2=0.2\quadæ•´æ•°éƒ¨åˆ†ä¸º0\\
   > 0.2\times2=0.4\quadæ•´æ•°éƒ¨åˆ†ä¸º0\\
   > 0.4\times2=0.8\quadæ•´æ•°éƒ¨åˆ†ä¸º0\\
   > 0.8\times2=1.6\quadæ•´æ•°éƒ¨åˆ†ä¸º1\\
   > 0.6\times2=1.2\quadæ•´æ•°éƒ¨åˆ†ä¸º1\\
   > ...
   > $$
   > æ‰€ä»¥$0.1_{10}$è½¬åŒ–ä¸ºäºŒè¿›åˆ¶æ˜¯$0.000110011001100...$ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ— é™å¾ªç¯äºŒè¿›åˆ¶å°æ•°ï¼Œå†™æˆäºŒè¿›åˆ¶è§„æ ¼åŒ–å½¢å¼ä¸º$1.10011001100...\times2^{-4}$
   > 
   > æ¥ä¸‹æ¥ç¡®å®šç¬¦å·ä½ã€æŒ‡æ•°ä½ã€å°¾æ•°
   > 
   >1. ç¬¦å·ä½ï¼šå› ä¸ºæ˜¯æ•´æ•°ï¼Œæ‰€ä»¥ç¬¦å·ä½æ˜¯0
   > 
   >2. æŒ‡æ•°ä½ï¼š8ä½ï¼Œ`-4`æ˜¯ç»è¿‡åç§»é‡æ³•è½¬åŒ–ä¹‹åçš„æŒ‡æ•°ï¼Œä¹Ÿå°±æ˜¯å‡å»`127`çš„ç»“æœï¼Œé‚£ä¹ˆåŸå§‹çš„æŒ‡æ•°ä¸º`123`,å…¶äºŒè¿›åˆ¶ä¸º$01111011_2$
   > 
   >3. å°¾æ•°ï¼š23ä½ï¼Œä¹Ÿå°±æ˜¯$1.10011001100_2...$å°æ•°ç‚¹åçš„23ä½ï¼Œå³100 1100 1100 1100 1100 1100 **1**
   > 
   >  > [!IMPORTANT]
   >    >
   >    > æœ€åé¢åŠ ç²—çš„1æ˜¯ç¬¬24ä½ï¼Œå› ä¸ºåªèƒ½ä¿ç•™23ä½ï¼Œåœ¨ç¬¬23ä½ä¸Šè¦æ ¹æ®24ä½è¿›è¡Œå››èˆäº”å…¥
   > 
   > æ‰€ä»¥$0.1_{10}$çš„äºŒè¿›åˆ¶è¡¨è¾¾æ˜¯$0\quad01111011\quad100\quad1100\quad1100\quad 1100\quad1100\quad1101$
   
2. åŒæ ·éµå®ˆIEEE 754æµ®ç‚¹æ•°æ ‡å‡†ï¼ŒJavaå’ŒC++è¾“å‡ºç»“æœæ˜¯å¦ç›¸åŒï¼Ÿ

   ```java
       //C++
       double var = 3.425;
       printf("var=%.16f\n", var);
   
       result
       ____________________
       var=3.4249999999999998
   
       //Java
       double var = 3.425;
       System.out.printf("var=%.16f\n", var);
   
       result
       ____________________
       var=3.4250000000000000
           
       //Java
       System.out.println(new BigDecimal(var).toPlainString())
       //3.42499999999999982236431605997495353221893310546875
   ```

     ![3.425](./3.425.png)

â€‹		è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæºè‡ªC++å’ŒJavaçš„è¾“å‡ºç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯C++é€‰æ‹©éµå¾ªåŸå§‹æ•°æ®å€¼ï¼Œè€ŒJavaé€‰æ‹©äº†éµå¾ªäººç±»æ˜“äº		ç†è§£çš„ç»“æœã€‚

3. æ•°æ®åº“ï¼ˆOracleï¼‰ä¸­å­˜å‚¨çš„æ•°å€¼ä¸º**932.525**ï¼Œåœ¨C++çš„å®¢æˆ·ç«¯ï¼Œä¿ç•™ä¸¤ä½å°æ•°æ˜¾ç¤ºä¸º**932.52**ï¼Œåœ¨åŸºäºJavaåç«¯ï¼ŒJavascriptå‰ç«¯çš„Webåº”ç”¨ä¸­ï¼Œä¿ç•™ä¸¤ä½å°æ•°åæ˜¾ç¤º**932.53**ï¼Œè°æ˜¾ç¤ºçš„æ˜¯å¯¹çš„ï¼Ÿ

   932.525è¿™ä¸ªæµ®ç‚¹æ•°ç”¨äºŒè¿›åˆ¶è¡¨è¾¾åˆ†ä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯æ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†ï¼š

   * æ•´æ•°éƒ¨åˆ†

     | è¿‡ç¨‹  |  å•†  | ä½™æ•° |
     | :---: | :--: | :--: |
     | 932/2 | 466  |  0   |
     | 466/2 | 233  |  0   |
     | 233/2 | 116  |  1   |
     | 116/2 |  58  |  0   |
     | 58/2  |  29  |  0   |
     | 29/2  |  14  |  1   |
     | 14/2  |  7   |  0   |
     |  7/2  |  3   |  1   |
     |  3/2  |  1   |  1   |
     |  1/2  |  0   |  1   |

     å› æ­¤æ•´æ•°éƒ¨åˆ†ä¸ºä½™æ•°ä»åå‘å‰çš„ç»“æœï¼š`1110100100`

   * å°æ•°éƒ¨åˆ†

     |  è¿‡ç¨‹   | ç»“æœ | æ•´æ•°éƒ¨åˆ† | å‰©ä½™å°æ•° |
     | :-----: | :--: | :------: | :------: |
     | 0.525*2 | 1.05 |    1     |   0.05   |
     | 0.05*2  | 0.1  |    0     |   0.1    |
     |  0.1*2  | 0.2  |    0     | **0.2**  |
     |  0.2*2  | 0.4  |    0     |   0.4    |
     |  0.4*2  | 0.8  |    0     |   0.8    |
     |  0.8*2  | 1.6  |    1     |   0.6    |
     |  0.6*2  | 1.2  |    1     | **0.2**  |

     å¯ä»¥çœ‹å‡ºï¼Œä»0.2å¼€å§‹å¾ªç¯ï¼Œå› æ­¤å°æ•°éƒ¨åˆ†çš„äºŒè¿›åˆ¶è¡¨è¾¾ä¸º`100 0011 0011 0011 0011...`

   * æ•´åˆç»“æœ

     `1110100100.1000011001100110011....`

     è§„æ ¼åŒ–ï¼ˆç§‘å­¦è®¡æ•°æ³•ï¼‰ï¼š$1.110100100\quad  100\quad 0011\quad 0011\quad 0011\quad 0011...\times2^{9}$

     å¯¹äº64ä½å•ç²¾åº¦ï¼š

     * ç¬¦å·ä½ï¼š0ï¼ˆ1 bitï¼‰

     * æŒ‡æ•°ä½ï¼š$1023+9=1032$ï¼ŒäºŒè¿›åˆ¶`10000001000`ï¼ˆ11 bitï¼‰

     * å°¾æ•°ï¼š110100100 100 **0011**001100110011001100110011001100110011ï¼ˆ52 bitï¼‰ï¼Œ$9+3+40=52$ï¼ŒæŒ‰ç…§å¾ªç¯èŠ‚ï¼ˆ0011ï¼‰ï¼Œç¬¬53ä½æ˜¯0ï¼Œå°äº$0.5_{10}$ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿèˆå…¥ã€‚

       > [!TIP]
       >
       > æµ®ç‚¹æ•°çš„èˆå…¥ç®—æ³•ï¼š
       >
       > * åè¿›åˆ¶ï¼ˆå››èˆäº”å…¥ï¼‰
       >   * å‡è®¾æˆ‘ä»¬è¦å°†ä¸€ä¸ªæ•°èˆå…¥åˆ°æ•´æ•°ï¼Œå¯¹äºæ•°å­— 2.46=2.5ï¼Œ2.41=2.4ã€‚
       >
       > * æµ®ç‚¹æ•°ï¼ˆèˆå…¥åˆ°æœ€æ¥è¿‘ï¼Œå¹³å±€é‡‡ç”¨Ties to Evenï¼ˆå‘å¶æ•°é æ‹¢ï¼‰ï¼‰
       >
       >   å¶æ•°é æ‹¢ï¼šå°±æ˜¯å°¾æ•°çš„æœ€ä½ä½å¦‚æœæ˜¯0å°±æ˜¯å¶æ•°ï¼Œå°¾æ•°æ˜¯1å°±æ˜¯å¥‡æ•°ã€‚
       >
       >   * å…ˆç”¨åè¿›åˆ¶æè¿°ï¼Œå¦‚æœä¿ç•™2ä½æœ‰æ•ˆæ•°å­—ï¼Œ1.2349=1.23ï¼Œ1.2351=1.24ï¼Œ1.2350ä»‹äº1.23å’Œ1.24ä¹‹é—´ï¼Œä¹Ÿå°±æ˜¯å¹³å±€ï¼Œé‚£ä¹ˆå‘å¶æ•°é æ‹¢ï¼Œä¹Ÿå°±æ˜¯1.24ã€‚å¦‚æœæ˜¯1.2450ï¼Œä»‹äº1.24å’Œ1.25ä¹‹é—´ï¼Œé‚£ä¹ˆå‘å¶æ•°é æ‹¢ï¼Œå°±æ˜¯1.24.
       >
       >   * å›åˆ°äºŒè¿›åˆ¶ï¼Œå¦‚æœä¿ç•™2ä½å°æ•°ï¼Œ1.10(11)ï¼Œå¤šä½™çš„11ï¼ˆäºŒè¿›åˆ¶$0.11_2$ï¼Œ$0.75_{10}$ï¼‰
       >
       >     * å½“å¤šä½™çš„æ•°å­—æ­£å¥½æ˜¯$0.5_{10}$ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿå¹³å±€ï¼Œè¯´æ˜åœ¨ä¸¤ä¸ªæ•°ä¸­é—´ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å‘å¶æ•°é æ‹¢ã€‚
       >
       >       10.11(100)ï¼š11.00ï¼Œå¤šä½™çš„æ•°å­—0.100=0.5ï¼Œå‘å¶æ•°é æ‹¢
       >
       >       10.10(100)ï¼š10.10ï¼Œå¤šä½™çš„æ•°å­—0.100=0.5ï¼Œ10.10å·²ç»ä¸ºå¶æ•°
       >
       >     * å½“åé¢å¤šä½™çš„æ•°å­—>0.5ï¼Œåˆ™å‘ä¸Šèˆå…¥
       >
       >       10.00(110)ï¼š10.01ï¼Œå¤šä½™çš„æ•°å­—0.110>0.5
       >
       >     * å½“åé¢å¤šä½™çš„æ•°å­—<0.5ï¼Œåˆ™å‘ä¸‹èˆå…¥
       >
       >       10.00(011)ï¼š10.00ï¼Œ å¤šä½™çš„æ•°å­—0.011<0.5

     ç»è¿‡äºŒè¿›åˆ¶è½¬åŒ–ï¼Œ$932.525_{10}=0 110100100 100 0011001100110011001100110011001100110011_2$ï¼Œè¿™ä¸ªäºŒè¿›åˆ¶å¯¹åº”çš„åè¿›åˆ¶ä¸º`932.5249999999999772626324556767940521240234375`

   * **ç»“è®ºï¼š**
     
     1. å› æ­¤C++çš„å®¢æˆ·ç«¯æŒ‰ç…§å°æ•°ç‚¹åä¿ç•™2ä½æœ‰æ•ˆæ•°å­—ï¼Œæ˜¾ç¤ºä¸º`932.52`
     2. Javaçš„åç«¯ç”¨BigDecimalæ¥932.525ï¼Œå¯ä»¥ç²¾ç¡®çš„æ¥æ”¶åˆ°è¿™ä¸ªå‚æ•°ï¼Œå¹¶è¿›è¡Œå°æ•°ä½æ•°çš„ä¿ç•™ï¼Œå†å‘å‰ç«¯ä¼ é€’ï¼Œå› æ­¤æœ€ç»ˆæ˜¾ç¤ºä¸º`932.53`
     
     æ‰€ä»¥ï¼Œæ— è®ºæ˜¯C++è¿˜æ˜¯Javaéƒ½æ²¡é”™ï¼Œé”™åœ¨æµ®ç‚¹æ•°è¿‡äºå¤æ‚ğŸ˜‚

4. ä¸åŒçš„è¯­è¨€ï¼Œå¦‚æœæ¶‰åŠåˆ°äº’ç›¸è°ƒç”¨ï¼Œæµ®ç‚¹å‹å‚æ•°ä¼ é€’æ—¶ï¼Œåº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ

   1. Javaè°ƒç”¨C++ï¼šå› ä¸ºJavaå’ŒC++çš„æµ®ç‚¹å‹æ•°æ®éƒ½éµå®ˆIEEE 754æ ‡å‡†ï¼Œå› æ­¤å¯ä»¥é€šè¿‡JNIçš„æ–¹å¼ï¼Œå°†Javaä¸­çš„floatæˆ–è€…doubleç›´æ¥ä¼ é€’ç»™C++ï¼Œä¸¤è¾¹å¯ä»¥ä¿æŒå¾ˆå¥½çš„æœ‰æ•ˆä½æ•°ï¼›å¦å¤–ä¸€ç§æ–¹å¼å¯ä»¥é‡‡ç”¨ä¼ é€’å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œå°†æ•°å­—å‚æ•°ä¼ é€’è¿‡å»ï¼Œåœ¨C++ç«¯å°†å­—ç¬¦ä¸²å†è½¬åŒ–ä¸ºæ•°å­—ã€‚
   2. Oracleè°ƒç”¨C++ï¼šOracleä¸­çš„BINARY_FLOATå’ŒBINARY_DOUBLEå°±æ˜¯éµå®ˆIEEE 754æ ‡å‡†çš„æµ®ç‚¹å‹ï¼Œå¯¹åº”ä¸C++/Javaçš„floatå’Œdoubleï¼Œå› æ­¤Oracleçš„å­˜å‚¨è¿‡ç¨‹è°ƒç”¨å¤–éƒ¨ç¨‹åºï¼ˆC++)æ—¶ï¼Œæ¶‰åŠæµ®ç‚¹å‹å‚æ•°ä¼ é€’æ—¶ï¼Œåº”è¯¥ä½¿ç”¨è¿™ä¸¤ç§ç±»å‹ï¼Œå¹¶ä¸”ä¿è¯å’Œæ¥æ”¶ç«¯ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯æ¥æ”¶ç«¯çš„å…¥å‚ç±»å‹æ˜¯doubleï¼ŒOracleçš„è°ƒç”¨å‡½æ•°å®å‚ä¹Ÿåº”è¯¥æ˜¯BINARY_DOUBLEç±»å‹ã€‚

5. Javaè¯­è¨€ä¸­ï¼Œä¸ºä»€ä¹ˆBigDecimalå°±å¯ä»¥è¡¨è¾¾ä»»æ„çš„ç²¾åº¦ï¼Ÿ

   `BigDecimal`æ˜¯åŸºäº**ä»»æ„ç²¾åº¦çš„æ•´æ•°**ï¼ˆé€šè¿‡ `BigInteger`ï¼‰å’Œ **10çš„æ•´æ•°æ¬¡å¹‚** æ¥è¡¨ç¤ºæµ®ç‚¹æ•°çš„ã€‚å…·ä½“æ¥è¯´ï¼Œ`BigDecimal`ä½¿ç”¨äº†ä¸€ä¸ª**æ•´æ•°éƒ¨åˆ†**å’Œä¸€ä¸ª**æŒ‡æ•°**æ¥è¡¨ç¤ºä»»æ„ç²¾åº¦çš„å°æ•°ã€‚

   * **è¡¨ç¤ºå½¢å¼**ï¼š`BigDecimal` ä½¿ç”¨ä¸€ç§ç±»ä¼¼äºç§‘å­¦è®¡æ•°æ³•çš„è¡¨ç¤ºæ–¹å¼ï¼š$value=mantissa\times10^{exponent}$

     å…¶ä¸­ï¼š

     * mantissaï¼ˆå°¾æ•°ï¼‰æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå®é™…æ•°å€¼çš„æœ‰æ•ˆéƒ¨åˆ†
     * exponentï¼ˆæŒ‡æ•°ï¼‰æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¿™ä¸ªæ•°å€¼éœ€è¦ä¹˜ä»¥ 10 çš„å¤šå°‘æ¬¡æ–¹ï¼Œç¡®å®šå°æ•°ç‚¹çš„ä½ç½®

     ä¾‹å¦‚ï¼š

     `123.456` å¯ä»¥è¡¨ç¤ºä¸º $123456 Ã— 10^{-3}$ï¼Œè¿™é‡Œ `123456` æ˜¯å°¾æ•°ï¼ˆmantissaï¼‰ï¼Œ`-3` æ˜¯æŒ‡æ•°ï¼ˆexponentï¼‰

   * å®ç°ç»†èŠ‚ï¼š
     * `BigDecimal` çš„ **å°¾æ•°ï¼ˆmantissaï¼‰** ä½¿ç”¨ `BigInteger` æ¥è¡¨ç¤ºã€‚`BigInteger` ç±»æä¾›äº†ä»»æ„ç²¾åº¦çš„æ•´æ•°è¡¨ç¤ºï¼Œå®ƒå¯ä»¥å¤„ç†æ¯” `long` ç±»å‹æ›´å¤§çš„æ•°ï¼Œå› æ­¤å¯ä»¥ç²¾ç¡®è¡¨ç¤ºéå¸¸å¤§çš„å°¾æ•°ã€‚`BigInteger`ç”¨ä¸€ä¸ªæ•°ç»„æ¥è¡¨ç¤ºæ•´æ•°çš„å„ä¸ªæ•°å­—ï¼Œå› æ­¤å®ƒå¯ä»¥è¡¨ç¤ºä»»æ„å¤§çš„æ•°å­—ï¼Œä»…ä»…å—é™äºè®¡ç®—æœºçš„å†…å­˜å¤§å°å’Œè®¡ç®—æœºçš„è®¡ç®—èƒ½åŠ›
     * **æŒ‡æ•°ï¼ˆexponentï¼‰** æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•´æ•°ï¼Œè¡¨ç¤ºæ•°å€¼çš„å°æ•°ç‚¹çš„ä½ç½®

6. ä¸ºä»€ä¹ˆè¦æœ‰éè§„çº¦åŒ–æ•°å­—ï¼Ÿ

   è§„çº¦åŒ–è§„èŒƒè¦æ±‚ï¼Œå½¢å¼ä¸º$(-1)^{sign}\times2^{exponent}\times1.b_1b_2..b_n$ï¼Œå°¾æ•°ä½ç¬¬ä¸€ä½å¿…é¡»æ˜¯1ï¼Œå¦‚æœæŒ‡æ•°ä½éƒ½ä¸º0ï¼Œä¹Ÿæ˜¯è§„çº¦åŒ–æ•°å­—ï¼Œå¯¹äºåŒç²¾åº¦æ¥è¯´ï¼Œå¤§äº0çš„æœ€å°çš„è§„çº¦åŒ–æ•°å­—å°±æ˜¯$2^{-1022}\times(1+0)=2^{-1022}$ï¼Œå¦‚æœæƒ³è¡¨è¾¾æ›´å°çš„æ•°å­—å°±æ— èƒ½ä¸ºåŠ›äº†ï¼Œä½†æ˜¯éè§„çº¦åŒ–å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå³å¯ä»¥è¡¨è¾¾æ›´æ¥è¿‘0çš„æ•°å­—ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è®©è´´è¿‘0çš„è®¡ç®—ç»“æœå˜å¾—æ›´å¹³æ»‘ï¼Œä¸ä¼šå‡ºç°çªç„¶ä¸‹æº¢åˆ°0çš„é—®é¢˜ã€‚ä¸¾ä¾‹ï¼Œä¸€ä¸ªéè§„çº¦åŒ–çš„æ•°å­—ï¼Œ$(-1)^0\times2^{-1022}\times0.10...0=2^{-1022}\times(0+2^{-1})=2^{-1023}$ï¼Œè¿™ä¸ªå€¼åŒæœ€å°è§„çº¦åŒ–æ•°å­—æ¯”èµ·æ¥ï¼Œå˜å¾—æ›´å°ï¼Œæ›´è´´è¿‘0ã€‚

## 4. æœ€ä½³å®è·µ

1. æµ®ç‚¹å‹æ•°æ®æ¯”è¾ƒå¤§å°

   ```java
   if (Math.abs(var - 0.1f) < 0.00001) {
       // var == 0.1
   }
   ```

2. è£…ç®±å’Œæ‹†ç®±

   **åº”è¯¥é¿å…åœ¨å¤§å¾ªç¯é€»è¾‘ä¸‹ï¼Œé¢‘ç¹çš„è£…ç®±å’Œæ‹†ç®±æµ®ç‚¹å‹ï¼ˆfloat/double<->BigDecimalï¼‰**

3. ä½•æ—¶ä½¿ç”¨BigDecimalæˆ–è€…double

   * å¯¹äºæ€§èƒ½è¦æ±‚ä¸é«˜çš„äººæœºäº¤äº’ç±»åº”ç”¨ï¼Œä¼˜å…ˆé€‰æ‹©BigDecimal
   * å¯¹äºæ€§èƒ½è¦æ±‚é«˜çš„ï¼Œåº”è¯¥è€ƒè™‘å°†æµ®ç‚¹å‹è½¬åŒ–ä¸ºæ•´å‹ï¼Œå›å†™æ•°æ®åº“æ—¶å†è½¬åŒ–ä¸ºæµ®ç‚¹å‹
   * åœ¨doubleæœ‰æ•ˆä½æ•°æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œdoubleä¾ç„¶æ˜¯æœ€ä½³å®è·µï¼Œä½†æ˜¯åº”é¿å…éšæ„æ··ç”¨doubleå’ŒBigDecimalï¼Œåº”ç”¨å†…å°½é‡ç»Ÿä¸€é£æ ¼

4. å¦‚ä½•æ­£ç¡®åˆå§‹åŒ–BigDecimal

   ```java
   BigDecimal var = new BigDecimal("123.456");
   ```

5. ä½•æ—¶å››èˆäº”å…¥

   * å¦‚æœç´¯è®¡è®¡ç®—éœ€è¦æ›´åŠ å‡†ç¡®çš„ç»“æœï¼Œåº”è¯¥åœ¨ç´¯è®¡åå››èˆäº”å…¥ã€‚æ¯”å¦‚è¯´è·å–åæ¡æ•°æ®çš„æ³¢åŠ¨ç‡ä¹‹å’Œï¼Œsumä¹‹åå†è¿›è¡Œå››èˆäº”å…¥æ›´å‡†ç¡®
   
   * å¦‚æœåœ¨è¡¨æ ¼æ§ä»¶ä¸­æ˜¾ç¤ºå°è®¡åˆè®¡ï¼Œç”±äºæ¯ä¸€æ¡æ•°æ®éƒ½è¿›è¡Œäº†å››èˆäº”å…¥ï¼Œå› æ­¤å°è®¡åˆè®¡çš„è®¡ç®—ï¼Œåº”è¯¥åŸºäºæ¯ä¸€æ¡å››èˆäº”å…¥çš„ç»“æœè¿›è¡Œç´¯è®¡
   
     **åŸå§‹æ•°æ®å¦‚ä¸‹**ï¼š
   
     | MEMBER_ID | CLIENT_ID |  QTY   |
     | :-------: | :-------: | :----: |
     |   0011    |     X     | 10.345 |
     |   0011    |     Y     | 20.456 |
     |   0015    |     X     | 30.123 |
     |   0015    |     Y     | 40.789 |
   
     å¦‚æœå¸Œæœ›å±•ç¤ºç»™å‰ç«¯çš„ç»“æœï¼Œæ¯ä¸€æ¡æ˜ç»†æ•°æ®éƒ½è¦ä¿ç•™2ä½å°æ•°ï¼ˆå››èˆäº”å…¥ï¼‰ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„åˆ†å±‚æ±‡æ€»(rollup)è¯­å¥
   
     ```sql
     SELECT
         CASE
             WHEN GROUPING(MEMBER_ID) = 1 THEN 'æ€»è®¡'
             WHEN GROUPING(CLIENT_ID) = 1 THEN 'å°è®¡'
             ELSE MEMBER_ID
         END AS MEMBER_ID,
         CLIENT_ID,
         SUM(qty) AS QTY_ORI,
         -- è¦å¯¹é€æ¡æ˜ç»†å…ˆè¿›è¡Œä¿ç•™2ä½å°æ•°çš„å››èˆäº”å…¥åŠ¨ä½œ
         -- æ±‡æ€»çš„å°è®¡å’Œåˆè®¡çš„ç»“æœä¹Ÿæ˜¯æŒ‰ç…§å¤„ç†è¿‡çš„æ˜ç»†æ•°æ®è¿›è¡Œç´¯è®¡è®¡ç®—
         -- å¦‚æœä¸åœ¨sumé‡Œé¢æ·»åŠ roundå¤„ç†ï¼Œé‚£ä¹ˆæ˜ç»†å’Œæ±‡æ€»ä¿ç•™äº†åŸå§‹çš„æœ‰æ•ˆä½æ•°ï¼ˆNUMBERç±»å‹ï¼‰
         SUM(round(qty, 2)) AS QTY,
         GROUPING(MEMBER_ID) AS ORDER1,
         MEMBER_ID AS ORDER2,
         GROUPING(CLIENT_ID) AS ORDER3
     FROM test
     GROUP BY ROLLUP(MEMBER_ID, CLIENT_ID)
     ORDER BY ORDER1, ORDER2, ORDER3
     ```
   
     
   
     | MEMBER_ID | CLIENT_ID |   QTY_ORI   |    QTY     | ORDER1 | ORDER2 | ORDER3 |
     | :-------: | :-------: | :---------: | :--------: | :----: | :----: | :----: |
     |   0011    |     X     |   10.345    |   10.35    |   0    |  0011  |   0    |
     |   0011    |     Y     |   20.456    |   20.46    |   0    |  0011  |   0    |
     | **å°è®¡**  |   NULL    | **30.801**  | **30.81**  |   0    |  0011  |   1    |
     |   0015    |     X     |   30.123    |   30.12    |   0    |  0015  |   0    |
     |   0015    |     Y     |   40.789    |   40.79    |   0    |  0015  |   0    |
     | **å°è®¡**  |   NULL    |  **30.81**  | **70.91**  |   0    |  0015  |   1    |
     | **æ€»è®¡**  |   NULL    | **101.713** | **101.72** |   1    |  NULL  |   1    |
   
     

## 5. å‚è€ƒä¿¡æ¯

### 5.1. IEEE 754çš„ç”±æ¥

1985å¹´ï¼Œç”±IEEEåä¼šå‘èµ·ç¼–å†™ï¼Œ754ä»£è¡¨æœ¬è§„èŒƒçš„ç¼–å·ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæµ®ç‚¹æ•°çš„åè®®å„å¼‚ï¼Œç»™æ•°æ®é€šä¿¡ã€åº”ç”¨äººå‘˜é€ æˆå¾ˆå¤šå›°æ‰°ã€‚

### 5.2. Java Doubleç±»ä¸­çš„å¸¸é‡

```java
public final class Double extends Number implements Comparable<Double> {
    /**
     * A constant holding the positive infinity of type
     * {@code double}. It is equal to the value returned by
     * {@code Double.longBitsToDouble(0x7ff0000000000000L)}.
     */
    public static final double POSITIVE_INFINITY = 1.0 / 0.0;

    /**
     * A constant holding the negative infinity of type
     * {@code double}. It is equal to the value returned by
     * {@code Double.longBitsToDouble(0xfff0000000000000L)}.
     */
    public static final double NEGATIVE_INFINITY = -1.0 / 0.0;

    /**
     * A constant holding a Not-a-Number (NaN) value of type
     * {@code double}. It is equivalent to the value returned by
     * {@code Double.longBitsToDouble(0x7ff8000000000000L)}.
     */
    public static final double NaN = 0.0d / 0.0;

    /**
     * A constant holding the largest positive finite value of type
     * {@code double},
     * (2-2<sup>-52</sup>)&middot;2<sup>1023</sup>.  It is equal to
     * the hexadecimal floating-point literal
     * {@code 0x1.fffffffffffffP+1023} and also equal to
     * {@code Double.longBitsToDouble(0x7fefffffffffffffL)}.
     */
    public static final double MAX_VALUE = 0x1.fffffffffffffP+1023; // 1.7976931348623157e+308

    /**
     * A constant holding the smallest positive normal value of type
     * {@code double}, 2<sup>-1022</sup>.  It is equal to the
     * hexadecimal floating-point literal {@code 0x1.0p-1022} and also
     * equal to {@code Double.longBitsToDouble(0x0010000000000000L)}.
     *
     * @since 1.6
     */
    public static final double MIN_NORMAL = 0x1.0p-1022; // 2.2250738585072014E-308

    /**
     * A constant holding the smallest positive nonzero value of type
     * {@code double}, 2<sup>-1074</sup>. It is equal to the
     * hexadecimal floating-point literal
     * {@code 0x0.0000000000001P-1022} and also equal to
     * {@code Double.longBitsToDouble(0x1L)}.
     */
    public static final double MIN_VALUE = 0x0.0000000000001P-1022; // 4.9e-324

    /**
     * Maximum exponent a finite {@code double} variable may have.
     * It is equal to the value returned by
     * {@code Math.getExponent(Double.MAX_VALUE)}.
     *
     * @since 1.6
     */
    public static final int MAX_EXPONENT = 1023;

    /**
     * Minimum exponent a normalized {@code double} variable may
     * have.  It is equal to the value returned by
     * {@code Math.getExponent(Double.MIN_NORMAL)}.
     *
     * @since 1.6
     */
    public static final int MIN_EXPONENT = -1022;

    /**
     * The number of bits used to represent a {@code double} value.
     *
     * @since 1.5
     */
    public static final int SIZE = 64;
    
    ....
}
```

### 5.3. å‚è€ƒæ–‡æ¡£

1. [Base Convert: IEEE 754 Floating Point](https://baseconvert.com/ieee-754-floating-point)
3. [IEEE 754 - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦ (wikipedia.org)](https://zh.wikipedia.org/zh-hans/IEEE_754)

